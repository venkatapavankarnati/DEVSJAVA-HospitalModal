name: Choco Package

on:
  workflow_dispatch: 

jobs:
  Testing:
    runs-on: windows-latest
    steps:
      - name: run only on testing-package
        if: github.ref != 'refs/heads/testing-package'
        run: |
          echo "this is a testing-package"
          exit 1
    
      - name: checkout to branch
        uses: actions/checkout@v2

      - name: Read package version
        uses: nyaa8/package-version@v1
        with:
          path: './validationTool/package.json'

      - name: Zipping the script
        run: | 
          Compress-Archive -Force -Path ".\validationTool\scripts" -DestinationPath ".\validationTool\testagain\tools\test.zip"

      - name: Chocolatey Package
        run: |
          $version = Get-Content -Path ".\validationTool\version_base"
          cd "validationTool\testagain"
          choco pack --version=${{env.PACKAGE_VERSION}}
          echo ${{env.PACKAGE_VERSION}}
          cd ..\..

      - name: Bump minor version
        uses: jaumann/github-bumpversion-action@v0.0.7
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          SOURCE: ./validationTool/package.json